{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/terryli/binance-futures-availability/schemas/availability-database.schema.json",
  "title": "Binance Futures Availability Database Schema",
  "description": "Schema definition for the DuckDB database tracking daily availability of Binance USDT perpetual futures from Vision S3",
  "version": "1.0.0",
  "type": "object",
  "properties": {
    "table": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string",
          "const": "daily_availability",
          "description": "Primary table name"
        },
        "columns": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string",
                "description": "Column name"
              },
              "type": {
                "type": "string",
                "enum": ["DATE", "VARCHAR", "BOOLEAN", "BIGINT", "TIMESTAMP", "INTEGER", "DOUBLE"],
                "description": "DuckDB data type"
              },
              "nullable": {
                "type": "boolean",
                "description": "Whether column accepts NULL values"
              },
              "description": {
                "type": "string",
                "description": "Column purpose and semantics"
              }
            },
            "required": ["name", "type", "nullable", "description"]
          },
          "minItems": 17,
          "description": "Column definitions (8 original + 9 volume metrics from ADR-0007)"
        },
        "primaryKey": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "minItems": 2,
          "maxItems": 2,
          "description": "Composite primary key columns"
        },
        "indexes": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string",
                "description": "Index name"
              },
              "columns": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "minItems": 1,
                "description": "Indexed columns in order"
              },
              "purpose": {
                "type": "string",
                "description": "Query optimization purpose"
              }
            },
            "required": ["name", "columns", "purpose"]
          },
          "description": "Index definitions"
        }
      },
      "required": ["name", "columns", "primaryKey", "indexes"]
    }
  },
  "required": ["table"],
  "definitions": {
    "daily_availability": {
      "description": "Concrete schema instance for daily_availability table",
      "type": "object",
      "properties": {
        "table": {
          "type": "object",
          "properties": {
            "name": {
              "const": "daily_availability"
            },
            "columns": {
              "const": [
                {
                  "name": "date",
                  "type": "DATE",
                  "nullable": false,
                  "description": "Trading date (UTC) being probed"
                },
                {
                  "name": "symbol",
                  "type": "VARCHAR",
                  "nullable": false,
                  "description": "Futures symbol (e.g., BTCUSDT, ETHUSDT)"
                },
                {
                  "name": "available",
                  "type": "BOOLEAN",
                  "nullable": false,
                  "description": "Whether 1m klines file exists on S3 Vision (true=200 OK, false=404)"
                },
                {
                  "name": "file_size_bytes",
                  "type": "BIGINT",
                  "nullable": true,
                  "description": "File size from Content-Length header (NULL if unavailable)"
                },
                {
                  "name": "last_modified",
                  "type": "TIMESTAMP",
                  "nullable": true,
                  "description": "S3 Last-Modified timestamp (NULL if unavailable)"
                },
                {
                  "name": "url",
                  "type": "VARCHAR",
                  "nullable": false,
                  "description": "Full S3 URL probed (for audit trail)"
                },
                {
                  "name": "status_code",
                  "type": "INTEGER",
                  "nullable": false,
                  "description": "HTTP status code (200, 404, etc.)"
                },
                {
                  "name": "probe_timestamp",
                  "type": "TIMESTAMP",
                  "nullable": false,
                  "description": "UTC timestamp when probe was executed"
                },
                {
                  "name": "quote_volume_usdt",
                  "type": "DOUBLE",
                  "nullable": true,
                  "description": "ADR-0007: USDT trading volume (primary ranking metric)"
                },
                {
                  "name": "trade_count",
                  "type": "BIGINT",
                  "nullable": true,
                  "description": "ADR-0007: Number of trades executed"
                },
                {
                  "name": "volume_base",
                  "type": "DOUBLE",
                  "nullable": true,
                  "description": "ADR-0007: Base asset trading volume (e.g., BTC for BTCUSDT)"
                },
                {
                  "name": "taker_buy_volume_base",
                  "type": "DOUBLE",
                  "nullable": true,
                  "description": "ADR-0007: Taker buy base asset volume"
                },
                {
                  "name": "taker_buy_quote_volume_usdt",
                  "type": "DOUBLE",
                  "nullable": true,
                  "description": "ADR-0007: Taker buy USDT volume"
                },
                {
                  "name": "open_price",
                  "type": "DOUBLE",
                  "nullable": true,
                  "description": "ADR-0007: Opening price for the day"
                },
                {
                  "name": "high_price",
                  "type": "DOUBLE",
                  "nullable": true,
                  "description": "ADR-0007: Highest price reached during the day"
                },
                {
                  "name": "low_price",
                  "type": "DOUBLE",
                  "nullable": true,
                  "description": "ADR-0007: Lowest price reached during the day"
                },
                {
                  "name": "close_price",
                  "type": "DOUBLE",
                  "nullable": true,
                  "description": "ADR-0007: Closing price for the day"
                }
              ]
            },
            "primaryKey": {
              "const": ["date", "symbol"]
            },
            "indexes": {
              "const": [
                {
                  "name": "idx_symbol_date",
                  "columns": ["symbol", "date"],
                  "purpose": "Fast timeline queries (get_symbol_availability_timeline)"
                },
                {
                  "name": "idx_available_date",
                  "columns": ["available", "date"],
                  "purpose": "Fast snapshot queries (get_available_symbols_on_date)"
                },
                {
                  "name": "idx_quote_volume_date",
                  "columns": ["quote_volume_usdt", "date"],
                  "purpose": "ADR-0007: Fast volume ranking queries (top N symbols by volume)"
                }
              ]
            }
          }
        }
      }
    }
  },
  "examples": [
    {
      "table": {
        "name": "daily_availability",
        "columns": [
          {
            "name": "date",
            "type": "DATE",
            "nullable": false,
            "description": "Trading date (UTC) being probed"
          },
          {
            "name": "symbol",
            "type": "VARCHAR",
            "nullable": false,
            "description": "Futures symbol (e.g., BTCUSDT, ETHUSDT)"
          },
          {
            "name": "available",
            "type": "BOOLEAN",
            "nullable": false,
            "description": "Whether 1m klines file exists on S3 Vision (true=200 OK, false=404)"
          },
          {
            "name": "file_size_bytes",
            "type": "BIGINT",
            "nullable": true,
            "description": "File size from Content-Length header (NULL if unavailable)"
          },
          {
            "name": "last_modified",
            "type": "TIMESTAMP",
            "nullable": true,
            "description": "S3 Last-Modified timestamp (NULL if unavailable)"
          },
          {
            "name": "url",
            "type": "VARCHAR",
            "nullable": false,
            "description": "Full S3 URL probed (for audit trail)"
          },
          {
            "name": "status_code",
            "type": "INTEGER",
            "nullable": false,
            "description": "HTTP status code (200, 404, etc.)"
          },
          {
            "name": "probe_timestamp",
            "type": "TIMESTAMP",
            "nullable": false,
            "description": "UTC timestamp when probe was executed"
          },
          {
            "name": "quote_volume_usdt",
            "type": "DOUBLE",
            "nullable": true,
            "description": "ADR-0007: USDT trading volume (primary ranking metric)"
          },
          {
            "name": "trade_count",
            "type": "BIGINT",
            "nullable": true,
            "description": "ADR-0007: Number of trades executed"
          },
          {
            "name": "volume_base",
            "type": "DOUBLE",
            "nullable": true,
            "description": "ADR-0007: Base asset trading volume (e.g., BTC for BTCUSDT)"
          },
          {
            "name": "taker_buy_volume_base",
            "type": "DOUBLE",
            "nullable": true,
            "description": "ADR-0007: Taker buy base asset volume"
          },
          {
            "name": "taker_buy_quote_volume_usdt",
            "type": "DOUBLE",
            "nullable": true,
            "description": "ADR-0007: Taker buy USDT volume"
          },
          {
            "name": "open_price",
            "type": "DOUBLE",
            "nullable": true,
            "description": "ADR-0007: Opening price for the day"
          },
          {
            "name": "high_price",
            "type": "DOUBLE",
            "nullable": true,
            "description": "ADR-0007: Highest price reached during the day"
          },
          {
            "name": "low_price",
            "type": "DOUBLE",
            "nullable": true,
            "description": "ADR-0007: Lowest price reached during the day"
          },
          {
            "name": "close_price",
            "type": "DOUBLE",
            "nullable": true,
            "description": "ADR-0007: Closing price for the day"
          }
        ],
        "primaryKey": ["date", "symbol"],
        "indexes": [
          {
            "name": "idx_symbol_date",
            "columns": ["symbol", "date"],
            "purpose": "Fast timeline queries (get_symbol_availability_timeline)"
          },
          {
            "name": "idx_available_date",
            "columns": ["available", "date"],
            "purpose": "Fast snapshot queries (get_available_symbols_on_date)"
          },
          {
            "name": "idx_quote_volume_date",
            "columns": ["quote_volume_usdt", "date"],
            "purpose": "ADR-0007: Fast volume ranking queries (top N symbols by volume)"
          }
        ]
      }
    }
  ]
}
